<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Snake Game (Single File)</title>
  <style>
    :root {
      --bg: #0f1221;
      --panel: #171a2e;
      --text: #e8e8f0;
      --muted: #a7acc3;
      --accent: #6ee7ff;
      --danger: #ff5c7a;
      --snake: #7CFF6B;
      --snakeHead: #00E676;
      --food: #FFCA28;
      --grid: rgba(255,255,255,.07);
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: grid;
      place-items: center;
      background: radial-gradient(1200px 600px at 20% 10%, #1b2050 0%, var(--bg) 55%, #090b14 100%);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
    }

    .wrap {
      width: min(720px, 92vw);
      display: grid;
      gap: 14px;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 14px;
      padding: 12px 14px;
      backdrop-filter: blur(8px);
    }

    .title {
      display: grid;
      gap: 2px;
    }
    .title h1 {
      margin: 0;
      font-size: 18px;
      letter-spacing: .2px;
    }
    .title small {
      color: var(--muted);
      font-size: 12px;
    }

    .stats {
      display: flex;
      align-items: center;
      gap: 10px;
      font-variant-numeric: tabular-nums;
    }
    .badge {
      background: rgba(110,231,255,.12);
      border: 1px solid rgba(110,231,255,.35);
      color: var(--text);
      padding: 8px 10px;
      border-radius: 12px;
      font-size: 13px;
      display: inline-flex;
      gap: 6px;
      align-items: center;
      white-space: nowrap;
    }
    .badge strong { color: var(--accent); font-weight: 700; }

    .panel {
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 14px;
      padding: 14px;
      display: grid;
      gap: 12px;
    }

    .game {
      display: grid;
      place-items: center;
      position: relative;
      overflow: hidden;
      border-radius: 12px;
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
      border: 1px solid rgba(255,255,255,.10);
    }

    canvas {
      width: min(560px, 90vw);
      height: min(560px, 90vw);
      display: block;
      image-rendering: pixelated;
    }

    .hint {
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
      display: flex;
      flex-wrap: wrap;
      gap: 8px 12px;
      align-items: center;
      justify-content: space-between;
    }
    .hint kbd {
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      border-bottom-color: rgba(255,255,255,.18);
      padding: 3px 7px;
      border-radius: 8px;
      font-size: 12px;
      color: var(--text);
      box-shadow: 0 2px 0 rgba(0,0,0,.25);
    }

    .overlay {
      position: absolute;
      inset: 0;
      display: none;
      place-items: center;
      background: rgba(7,9,18,.55);
      backdrop-filter: blur(4px);
      padding: 18px;
      text-align: center;
    }

    .overlay.show { display: grid; }

    .card {
      width: min(420px, 92%);
      border-radius: 14px;
      padding: 16px 14px;
      background: rgba(23,26,46,.92);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 16px 40px rgba(0,0,0,.35);
      display: grid;
      gap: 10px;
    }

    .card h2 {
      margin: 0;
      font-size: 18px;
    }
    .card p {
      margin: 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.6;
    }

    .actions {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 6px;
      flex-wrap: wrap;
    }

    button {
      cursor: pointer;
      border: 0;
      padding: 10px 12px;
      border-radius: 12px;
      color: #0b0d16;
      background: linear-gradient(180deg, #7df6ff, #2fd4ff);
      font-weight: 700;
      letter-spacing: .2px;
      transition: transform .08s ease, filter .2s ease;
    }
    button:active { transform: translateY(1px); }
    button.secondary {
      color: var(--text);
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      font-weight: 600;
    }

    .danger { color: var(--danger); }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="title">
        <h1>ğŸ Snake Game</h1>
        <small>í™”ì‚´í‘œ í‚¤ë¡œ ì´ë™ Â· <kbd>Space</kbd> ì‹œì‘/ì¼ì‹œì •ì§€ Â· <kbd>R</kbd> ì¬ì‹œì‘</small>
      </div>
      <div class="stats">
        <span class="badge">ì ìˆ˜: <strong id="score">0</strong></span>
        <span class="badge">ìµœê³ : <strong id="best">0</strong></span>
        <span class="badge">ì†ë„: <strong id="speedLabel">8</strong></span>
      </div>
    </div>

    <div class="panel">
      <div class="game">
        <canvas id="c" width="560" height="560" aria-label="Snake game canvas"></canvas>

        <div id="overlay" class="overlay show">
          <div class="card">
            <h2 id="overlayTitle">ê²Œì„ ì‹œì‘</h2>
            <p id="overlayDesc">
              <kbd>Space</kbd>ë¥¼ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”. í™”ì‚´í‘œ í‚¤ë¡œ ë±€ì„ ì›€ì§ì´ê³  ë¨¹ì´ë¥¼ ë¨¹ì–´ ì ìˆ˜ë¥¼ ì˜¬ë¦½ë‹ˆë‹¤.
              ë²½ì´ë‚˜ ëª¸ì— ë¶€ë”ªíˆë©´ <span class="danger">ê²Œì„ ì˜¤ë²„</span>!
            </p>
            <div class="actions">
              <button id="startBtn">ì‹œì‘ (Space)</button>
              <button id="restartBtn" class="secondary">ì¬ì‹œì‘ (R)</button>
            </div>
          </div>
        </div>
      </div>

      <div class="hint">
        <div>
          ì¡°ì‘: <kbd>â†‘</kbd><kbd>â†“</kbd><kbd>â†</kbd><kbd>â†’</kbd>
          Â· <kbd>Space</kbd> ì‹œì‘/ì¼ì‹œì •ì§€ Â· <kbd>R</kbd> ì¬ì‹œì‘
        </div>
        <div>
          íŒ: ë¨¹ì´ë¥¼ ì—°ì†ìœ¼ë¡œ ë¨¹ìœ¼ë©´ ì†ë„ê°€ ì¡°ê¸ˆì”© ë¹¨ë¼ì§‘ë‹ˆë‹¤.
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== ì„¤ì • ======
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');

    const scoreEl = document.getElementById('score');
    const bestEl = document.getElementById('best');
    const speedLabelEl = document.getElementById('speedLabel');

    const overlay = document.getElementById('overlay');
    const overlayTitle = document.getElementById('overlayTitle');
    const overlayDesc = document.getElementById('overlayDesc');
    const startBtn = document.getElementById('startBtn');
    const restartBtn = document.getElementById('restartBtn');

    const GRID = 28;                 // 28x28 ì¹¸ (560px ê¸°ì¤€ 20px/ì¹¸)
    const CELL = canvas.width / GRID;

    // ê¸°ë³¸ ì†ë„(ì´ˆë‹¹ ì´ë™ íšŸìˆ˜) - ë¨¹ì´ë¥¼ ë¨¹ì„ìˆ˜ë¡ ì•½ê°„ ì¦ê°€
    const BASE_SPEED = 8;
    const SPEED_STEP = 0.35;
    const MAX_SPEED = 18;

    // ìƒ‰ìƒ
    const COLORS = {
      grid: getCssVar('--grid'),
      snake: getCssVar('--snake'),
      head: getCssVar('--snakeHead'),
      food: getCssVar('--food'),
      panel: 'rgba(0,0,0,0.18)'
    };

    function getCssVar(name) {
      return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
    }

    // ====== ê²Œì„ ìƒíƒœ ======
    let snake, dir, nextDir, food, score, best, speed;
    let running = false;
    let gameOver = false;

    // ì‹œê°„ ê¸°ë°˜ ì´ë™(í”„ë ˆì„ ë…ë¦½)
    let lastTime = 0;
    let accumulator = 0;

    // localStorage ìµœê³ ì 
    best = Number(localStorage.getItem('snake_best') || 0);
    bestEl.textContent = best;

    // ====== ì´ˆê¸°í™” ======
    function resetGame() {
      snake = [
        { x: 14, y: 14 },
        { x: 13, y: 14 },
        { x: 12, y: 14 }
      ];
      dir = { x: 1, y: 0 };       // í˜„ì¬ ì´ë™ ë°©í–¥
      nextDir = { x: 1, y: 0 };   // ë‹¤ìŒ í‹±ì— ì ìš©ë  ë°©í–¥(ê¸‰íšŒì „/ì—­ë°©í–¥ ë°©ì§€)
      score = 0;
      speed = BASE_SPEED;
      running = false;
      gameOver = false;
      accumulator = 0;
      lastTime = 0;

      placeFood();
      updateUI();
      showOverlay('ê²Œì„ ì‹œì‘', 'Spaceë¥¼ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”. í™”ì‚´í‘œ í‚¤ë¡œ ì¡°ì‘í•©ë‹ˆë‹¤.');
      draw(); // ì²« í™”ë©´ ë Œë”
    }

    function updateUI() {
      scoreEl.textContent = score;
      speedLabelEl.textContent = speed.toFixed(1).replace(/\.0$/, '');
      if (score > best) {
        best = score;
        localStorage.setItem('snake_best', String(best));
        bestEl.textContent = best;
      }
    }

    // ====== ë¨¹ì´ ë°°ì¹˜ ======
    function placeFood() {
      // ë±€ ëª¸í†µê³¼ ê²¹ì¹˜ì§€ ì•ŠëŠ” ì¢Œí‘œë¥¼ ì°¾ê¸°
      while (true) {
        const x = Math.floor(Math.random() * GRID);
        const y = Math.floor(Math.random() * GRID);
        const hit = snake?.some(s => s.x === x && s.y === y);
        if (!hit) {
          food = { x, y };
          return;
        }
      }
    }

    // ====== ì…ë ¥ ì²˜ë¦¬ ======
    function setDirection(dx, dy) {
      // ì—­ë°©í–¥ ê¸ˆì§€: í˜„ì¬ ë°©í–¥ì˜ ë°˜ëŒ€ë©´ ë¬´ì‹œ
      if (dx === -dir.x && dy === -dir.y) return;
      nextDir = { x: dx, y: dy };
    }

    window.addEventListener('keydown', (e) => {
      const k = e.key;

      // í™”ì‚´í‘œ í‚¤ ìŠ¤í¬ë¡¤ ë°©ì§€
      if (['ArrowUp','ArrowDown','ArrowLeft','ArrowRight',' '].includes(k)) {
        e.preventDefault();
      }

      if (k === 'ArrowUp') setDirection(0, -1);
      else if (k === 'ArrowDown') setDirection(0, 1);
      else if (k === 'ArrowLeft') setDirection(-1, 0);
      else if (k === 'ArrowRight') setDirection(1, 0);
      else if (k === ' ') toggleRun();          // Space
      else if (k.toLowerCase() === 'r') restart();
    }, { passive: false });

    startBtn.addEventListener('click', () => toggleRun());
    restartBtn.addEventListener('click', () => restart());

    function toggleRun() {
      if (gameOver) return; // ê²Œì„ì˜¤ë²„ë©´ Spaceë¡œ ì¬ì‹œì‘ ìœ ë„
      running = !running;
      if (running) {
        hideOverlay();
        requestAnimationFrame(loop);
      } else {
        showOverlay('ì¼ì‹œì •ì§€', 'Spaceë¥¼ ëˆŒëŸ¬ ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”.');
      }
    }

    function restart() {
      resetGame();
    }

    // ====== ë©”ì¸ ë£¨í”„ ======
    function loop(timestamp) {
      if (!running) return;

      if (!lastTime) lastTime = timestamp;
      const dt = (timestamp - lastTime) / 1000;
      lastTime = timestamp;

      // speed(ì´ˆë‹¹ ì´ë™íšŸìˆ˜)ì— ë§ì¶”ì–´ ëˆ„ì 
      accumulator += dt;
      const step = 1 / speed;

      while (accumulator >= step && running) {
        tick();
        accumulator -= step;
      }

      draw();
      if (running) requestAnimationFrame(loop);
    }

    // ====== ê²Œì„ ì§„í–‰(í•œ í‹±) ======
    function tick() {
      // ë‹¤ìŒ ë°©í–¥ ì ìš©
      dir = { ...nextDir };

      const head = snake[0];
      const newHead = { x: head.x + dir.x, y: head.y + dir.y };

      // ë²½ ì¶©ëŒ
      if (newHead.x < 0 || newHead.x >= GRID || newHead.y < 0 || newHead.y >= GRID) {
        endGame('ê²Œì„ ì˜¤ë²„', 'ë²½ì— ë¶€ë”ªí˜”ìŠµë‹ˆë‹¤. Rë¡œ ì¬ì‹œì‘í•˜ê±°ë‚˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.');
        return;
      }

      // ìê¸° ëª¸ ì¶©ëŒ (ê¼¬ë¦¬ê°€ ì´ë™í•˜ê¸° ì „ì— ê²€ì‚¬í•˜ë©´, ë¨¹ì´ë¥¼ ì•ˆ ë¨¹ëŠ” ê²½ìš° ê¼¬ë¦¬ê°€ ë¹ ì§ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ
      // "ì´ë™ í›„ ëª¸" ê¸°ì¤€ìœ¼ë¡œ ê²€ì‚¬: ë¨¼ì € newHeadë¥¼ ì¶”ê°€í•˜ê³ , ë¨¹ì´ ì—¬ë¶€ì— ë”°ë¼ ê¼¬ë¦¬ë¥¼ ì œê±°í•œ ë’¤ ê²€ì‚¬)
      snake.unshift(newHead);

      // ë¨¹ì´ ë¨¹ê¸°
      if (newHead.x === food.x && newHead.y === food.y) {
        score += 10;
        // ì†ë„ ì¦ê°€
        speed = Math.min(MAX_SPEED, BASE_SPEED + (score / 10) * SPEED_STEP);
        placeFood();
      } else {
        // ì•ˆ ë¨¹ì—ˆìœ¼ë©´ ê¼¬ë¦¬ í•œ ì¹¸ ì¤„ì´ê¸°
        snake.pop();
      }

      // ìê¸° ëª¸ ì¶©ëŒ ê²€ì‚¬
      for (let i = 1; i < snake.length; i++) {
        if (snake[i].x === newHead.x && snake[i].y === newHead.y) {
          endGame('ê²Œì„ ì˜¤ë²„', 'ìê¸° ëª¸ì— ë¶€ë”ªí˜”ìŠµë‹ˆë‹¤. Rë¡œ ì¬ì‹œì‘í•˜ê±°ë‚˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.');
          return;
        }
      }

      updateUI();
    }

    function endGame(title, desc) {
      running = false;
      gameOver = true;
      updateUI();
      showOverlay(title, desc + ` (ì ìˆ˜: ${score})`);
      overlayTitle.classList.add('danger');
    }

    // ====== ë Œë”ë§ ======
    function draw() {
      // ë°°ê²½
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // ì‚´ì§ ì–´ë‘ìš´ íŒ¨ë„
      ctx.fillStyle = COLORS.panel;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // ê·¸ë¦¬ë“œ
      ctx.strokeStyle = COLORS.grid;
      ctx.lineWidth = 1;
      for (let i = 0; i <= GRID; i++) {
        const p = i * CELL;
        ctx.beginPath();
        ctx.moveTo(p, 0);
        ctx.lineTo(p, canvas.height);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(0, p);
        ctx.lineTo(canvas.width, p);
        ctx.stroke();
      }

      // ë¨¹ì´
      drawCell(food.x, food.y, COLORS.food, true);

      // ë±€
      snake.forEach((seg, idx) => {
        const color = idx === 0 ? COLORS.head : COLORS.snake;
        drawCell(seg.x, seg.y, color, idx === 0);
      });

      // ê²Œì„ì˜¤ë²„ ìƒíƒœë©´ ìº”ë²„ìŠ¤ì— ì•ˆë‚´ í…ìŠ¤íŠ¸ë„ ê°„ë‹¨íˆ
      if (gameOver) {
        ctx.fillStyle = 'rgba(0,0,0,0.35)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 26px ui-sans-serif, system-ui';
        ctx.textAlign = 'center';
        ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2 - 10);
        ctx.font = '14px ui-sans-serif, system-ui';
        ctx.fillStyle = 'rgba(255,255,255,0.85)';
        ctx.fillText('Rë¡œ ì¬ì‹œì‘', canvas.width / 2, canvas.height / 2 + 18);
      }
    }

    function drawCell(x, y, color, glow = false) {
      const px = x * CELL;
      const py = y * CELL;
      const pad = 2;
      const w = CELL - pad * 2;
      const h = CELL - pad * 2;

      if (glow) {
        ctx.save();
        ctx.shadowColor = color;
        ctx.shadowBlur = 10;
        roundRect(px + pad, py + pad, w, h, 6, color);
        ctx.restore();
      } else {
        roundRect(px + pad, py + pad, w, h, 6, color);
      }
    }

    function roundRect(x, y, w, h, r, fillStyle) {
      const rr = Math.min(r, w / 2, h / 2);
      ctx.beginPath();
      ctx.moveTo(x + rr, y);
      ctx.arcTo(x + w, y, x + w, y + h, rr);
      ctx.arcTo(x + w, y + h, x, y + h, rr);
      ctx.arcTo(x, y + h, x, y, rr);
      ctx.arcTo(x, y, x + w, y, rr);
      ctx.closePath();
      ctx.fillStyle = fillStyle;
      ctx.fill();
    }

    // ====== ì˜¤ë²„ë ˆì´ ======
    function showOverlay(title, desc) {
      overlayTitle.textContent = title;
      overlayDesc.textContent = desc;
      overlayTitle.classList.toggle('danger', /ì˜¤ë²„/.test(title) || /OVER/.test(title));
      overlay.classList.add('show');
    }

    function hideOverlay() {
      overlay.classList.remove('show');
      overlayTitle.classList.remove('danger');
    }

    // ì‹¤í–‰
    resetGame();
  </script>
</body>
</html>
